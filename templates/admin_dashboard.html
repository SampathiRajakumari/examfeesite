{% extends "base.html" %}
{% block content %}

<style>
body {
    background: url("{{ url_for('static', filename='admin_dashb.png') }}") no-repeat center center fixed;
    background-size: cover;
    font-family: Arial, sans-serif;
}
.content-box {
    background: rgba(255,255,255,0.1); /* semi-transparent */
    padding: 25px;
    border-radius: 12px;
    max-width: 1100px;
    margin: auto;
    color: #000;
}
.content-box h2, h3, p, th, td, label {
    color: #000;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    background: transparent;
}
th, td {
    border: 1px solid #000;
    padding: 10px;
    text-align: center;
}
tr.pending {
    background-color: rgba(255, 200, 200, 0.3); /* highlight students with due */
}
ul {
    list-style: none;
    padding: 0;
}
ul li {
    margin: 8px 0;
}
.btn {
    margin-top: 8px;
    padding: 6px 12px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}
.btn-success {
    background-color: #4CAF50;
    color: white;
}
.btn-success:hover {
    background-color: #45a049;
}
.btn-danger {
    background-color: #f44336;
    color: white;
}
.btn-danger:hover {
    background-color: #d32f2f;
}
.btn-add {
    background-color: #2196F3;
    color: white;
}
.btn-add:hover {
    background-color: #0b7dda;
}
</style>

<div class="content-box">
    <h2>Admin Dashboard</h2>

    <h3>Branches & Sections</h3>
    <ul>
        {% for branch in branches %}
            <li>
                <strong>{{ branch['name'] }}</strong> - 
                <a href="{{ url_for('add_section', branch_id=branch['id']) }}">Manage Sections</a>
                {% set sections = get_sections(branch['id']) %}
                <ul>
                    {% for sec in sections %}
                        <li>
                            Section {{ sec['name'] }} -
                            <a href="{{ url_for('admin_add_student', branch_id=branch['id'], section_id=sec['id']) }}" class="btn btn-add">Add Student</a> |
                            <a href="{{ url_for('view_students', branch_id=branch['id'], section_id=sec['id']) }}">View Students</a>
                        </li>
                    {% endfor %}
                </ul>
            </li>
        {% endfor %}
    </ul>

    <h3>Students Requesting Admin Payment</h3>
    {% if requested_students %}
    <table>
        <tr>
            <th>Student ID</th>
            <th>Name</th>
            <th>Due Amount</th>
            <th>Action</th>
        </tr>
        {% for s in requested_students %}
        <tr class="{% if s['balance'] > 0 %}pending{% endif %}">
            <td>{{ s['sid'] }}</td>
            <td>{{ s['name'] }}</td>
            <td>â‚¹{{ s['balance'] }}</td>
            <td>
                <form method="post" action="{{ url_for('admin_pay_fee', sid=s['sid']) }}" onsubmit="return confirm('Are you sure you want to pay this amount?');">
                    <input type="number" name="amount" placeholder="Enter amount" max="{{ s['balance'] }}" required>
                    <button type="submit" class="btn btn-success">Pay Fee</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>
    {% else %}
    <p>No students requesting payment.</p>
    {% endif %}

    <a href="{{ url_for('admin_logout') }}" class="btn btn-danger">Logout</a>
</div>

{% endblock %}
